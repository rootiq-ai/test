<dashboard version="1.1" script="alerting_framework.js" stylesheet="alerting_framework.css" hideFilters="true">
  <label>Alerting Framework</label>
  <description>Create and manage Splunk alerts - by Kamal Bisht</description>
  
  <row>
    <panel>
      <html>
        <div id="quick-start-header" style="background:#4caf50;color:white;padding:12px;border-radius:4px;cursor:pointer;">
          <span id="qs-icon">â–¶</span> Quick Start - Macros, Examples &amp; Templates
        </div>
      </html>
    </panel>
  </row>
  
  <row id="quick_start_content">
    <panel>
      <title>Macros</title>
      <html>
        <div id="macros-container" style="max-height:250px;overflow-y:auto;overflow-x:hidden;border:1px solid #ddd;padding:10px;border-radius:4px;">Loading macros...</div>
        <button class="btn btn-default btn-sm" id="btn-refresh-macros" style="margin-top:10px;">Refresh</button>
      </html>
    </panel>
    <panel>
      <title>Examples</title>
      <html>
        <div id="examples-container" style="max-height:250px;overflow-y:auto;overflow-x:hidden;border:1px solid #ddd;padding:10px;border-radius:4px;">
          <div style="margin-bottom:8px;padding:8px;background:#f5f5f5;border-radius:4px;overflow:hidden;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
              <strong style="font-size:12px;">Internal Logs</strong>
              <button class="btn btn-primary btn-xs btn-use-example" data-query="index=_internal | stats count by component | head 10" style="padding:2px 8px;">Use</button>
            </div>
            <code style="font-size:10px;display:block;background:#e8e8e8;padding:5px;border-radius:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">index=_internal | stats count by component | head 10</code>
          </div>
          <div style="margin-bottom:8px;padding:8px;background:#f5f5f5;border-radius:4px;overflow:hidden;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
              <strong style="font-size:12px;">Index Stats</strong>
              <button class="btn btn-primary btn-xs btn-use-example" data-query="index=* | stats count by index | head 10" style="padding:2px 8px;">Use</button>
            </div>
            <code style="font-size:10px;display:block;background:#e8e8e8;padding:5px;border-radius:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">index=* | stats count by index | head 10</code>
          </div>
          <div style="margin-bottom:8px;padding:8px;background:#f5f5f5;border-radius:4px;overflow:hidden;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
              <strong style="font-size:12px;">Error Logs</strong>
              <button class="btn btn-primary btn-xs btn-use-example" data-query="index=_internal log_level=ERROR | stats count by component" style="padding:2px 8px;">Use</button>
            </div>
            <code style="font-size:10px;display:block;background:#e8e8e8;padding:5px;border-radius:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">index=_internal log_level=ERROR | stats count by component</code>
          </div>
          <div style="padding:8px;background:#f5f5f5;border-radius:4px;overflow:hidden;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
              <strong style="font-size:12px;">Sourcetype Summary</strong>
              <button class="btn btn-primary btn-xs btn-use-example" data-query="index=* | stats count by sourcetype | head 20" style="padding:2px 8px;">Use</button>
            </div>
            <code style="font-size:10px;display:block;background:#e8e8e8;padding:5px;border-radius:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">index=* | stats count by sourcetype | head 20</code>
          </div>
        </div>
      </html>
    </panel>
    <panel>
      <title>Templates</title>
      <html>
        <div id="templates-container" style="max-height:250px;overflow-y:auto;overflow-x:hidden;border:1px solid #ddd;padding:10px;border-radius:4px;">
          Loading templates...
        </div>
        <button class="btn btn-default btn-sm" id="btn-refresh-templates" style="margin-top:10px;">Refresh</button>
      </html>
    </panel>
  </row>
  
  <row>
    <panel>
      <html><hr style="margin:20px 0;"/></html>
    </panel>
  </row>
  
  <row>
    <panel>
      <title>Alert Configuration</title>
      <html>
        <div class="alert-form-container">
          
          <!-- Card 1: Alert Identity -->
          <div class="form-card">
            <div style="display:flex;gap:15px;margin-bottom:15px;">
              <div style="flex:2;">
                <label class="form-label">Alert Name <span style="color:red;">*</span></label>
                <input type="text" id="fld_alert_name" class="form-input" placeholder="Enter alert name"/>
                <div id="err_alert_name" class="form-error"></div>
              </div>
              <div style="flex:1;">
                <label class="form-label">Application Name <span style="color:red;">*</span></label>
                <input type="text" id="fld_app_name" class="form-input" placeholder="e.g., MyApp"/>
                <div id="err_app_name" class="form-error"></div>
              </div>
              <div style="flex:1;">
                <label class="form-label">Ticket Creation <span style="color:red;">*</span></label>
                <select id="fld_ticket" class="form-input">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </div>
            </div>
            
            <!-- Ticket Fields (conditionally shown) -->
            <div id="ticket-fields-container" style="display:none;background:#e3f2fd;padding:12px;border-radius:4px;margin-top:10px;">
              <div style="display:flex;gap:15px;">
                <div style="flex:1;">
                  <label class="form-label">Priority</label>
                  <select id="fld_priority" class="form-input">
                    <option value="P1">P1 - Critical</option>
                    <option value="P2">P2 - High</option>
                    <option value="P3" selected="selected">P3 - Medium</option>
                    <option value="P4">P4 - Low</option>
                  </select>
                </div>
                <div style="flex:1;">
                  <label class="form-label">Event Class <span style="color:red;">*</span></label>
                  <input type="text" id="fld_eventclass" class="form-input" placeholder="e.g., Infrastructure"/>
                  <div id="err_eventclass" class="form-error"></div>
                </div>
                <div style="flex:1;">
                  <label class="form-label">Assignment Group <span style="color:red;">*</span></label>
                  <input type="text" id="fld_assignment" class="form-input" placeholder="e.g., Platform-Support"/>
                  <div id="err_assignment" class="form-error"></div>
                </div>
                <div style="flex:1;">
                  <label class="form-label">Org Code <span style="color:red;">*</span></label>
                  <input type="text" id="fld_orgcode" class="form-input" placeholder="e.g., ORG001"/>
                  <div id="err_orgcode" class="form-error"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Card 2: Splunk Query -->
          <div class="form-card">
            <label class="form-label">Splunk Query <span style="color:red;">*</span></label>
            <textarea id="fld_query" rows="4" class="form-input" style="font-family:monospace;" placeholder="Enter SPL query..."></textarea>
            <div id="err_query" class="form-error"></div>
            <div style="margin-top:8px;">
              <button class="btn btn-default btn-sm" id="btn-expand-macros">Expand Macros</button>
              <button class="btn btn-default btn-sm" id="btn-validate-query">Validate Query</button>
              <span id="query-status" style="margin-left:10px;font-weight:bold;"></span>
            </div>
          </div>
          
          <!-- Card 3: Two-column layout for Email and Schedule -->
          <div style="display:flex;gap:20px;">
            
            <!-- Left: Email Notification -->
            <div class="form-card" style="flex:1;">
              <div style="margin-bottom:12px;">
                <label class="form-label">Email IDs <span style="color:red;">*</span></label>
                <input type="text" id="fld_email" class="form-input" placeholder="user@domain.com"/>
                <div style="font-size:10px;color:#666;margin-top:2px;">Separate multiple with commas</div>
                <div id="err_email" class="form-error"></div>
              </div>
              <div style="margin-bottom:12px;">
                <label class="form-label">Email Subject <span style="color:red;">*</span></label>
                <input type="text" id="fld_subject" class="form-input" placeholder="Alert: $name$"/>
                <div id="err_subject" class="form-error"></div>
              </div>
              <div>
                <label class="form-label">Email Body <span style="color:red;">*</span></label>
                <textarea id="fld_body" rows="3" class="form-input" placeholder="Alert details..."></textarea>
                <div id="err_body" class="form-error"></div>
              </div>
            </div>
            
            <!-- Right: Schedule and Trigger -->
            <div class="form-card" style="flex:1;">
              <div style="display:flex;gap:15px;margin-bottom:12px;">
                <div style="flex:1;position:relative;">
                  <label class="form-label">Duration</label>
                  <div id="tp-wrap" style="position:relative;">
                    <button type="button" id="tp-btn" style="display:flex;align-items:center;width:100%;padding:7px 10px;background:#fff;border:1px solid #ccc;border-radius:4px;cursor:pointer;font-size:13px;text-align:left;color:#333;">
                      <span style="margin-right:6px;color:#999;">&#128339;</span>
                      <span id="tp-label" style="flex:1;">Last 15 minutes</span>
                      <span style="color:#999;font-size:10px;">&#9662;</span>
                    </button>
                    <div id="tp-menu" style="display:none;position:absolute;top:100%;left:0;width:420px;background:#fff;border:1px solid #ccc;border-radius:4px;box-shadow:0 6px 20px rgba(0,0,0,.15);z-index:12000;margin-top:2px;">
                      <!-- Accordion: Presets -->
                      <div class="tp-acc-head tp-acc-open" data-sec="presets" style="padding:9px 14px;font-size:13px;color:#5ba1cf;cursor:pointer;border-bottom:1px solid #eee;font-weight:500;">
                        <span class="tp-arrow" style="display:inline-block;font-size:10px;margin-right:5px;">&#9662;</span>Presets
                      </div>
                      <div class="tp-acc-body" data-sec="presets" style="max-height:220px;overflow-y:auto;">
                        <a class="tp-opt" data-e="-5m" data-l="now" href="#">Last 5 minutes</a>
                        <a class="tp-opt tp-opt-sel" data-e="-15m" data-l="now" href="#">Last 15 minutes</a>
                        <a class="tp-opt" data-e="-30m" data-l="now" href="#">Last 30 minutes</a>
                        <a class="tp-opt" data-e="-60m" data-l="now" href="#">Last 60 minutes</a>
                        <a class="tp-opt" data-e="-4h" data-l="now" href="#">Last 4 hours</a>
                        <a class="tp-opt" data-e="-24h" data-l="now" href="#">Last 24 hours</a>
                        <a class="tp-opt" data-e="-7d" data-l="now" href="#">Last 7 days</a>
                        <a class="tp-opt" data-e="-30d" data-l="now" href="#">Last 30 days</a>
                        <a class="tp-opt" data-e="@d" data-l="now" href="#">Today</a>
                        <a class="tp-opt" data-e="-1d@d" data-l="@d" href="#">Yesterday</a>
                        <a class="tp-opt" data-e="@w0" data-l="now" href="#">Week to date</a>
                        <a class="tp-opt" data-e="0" data-l="now" href="#">All time</a>
                      </div>
                      <!-- Accordion: Relative -->
                      <div class="tp-acc-head" data-sec="relative" style="padding:9px 14px;font-size:13px;color:#5ba1cf;cursor:pointer;border-bottom:1px solid #eee;font-weight:500;">
                        <span class="tp-arrow" style="display:inline-block;font-size:10px;margin-right:5px;">&#9656;</span>Relative
                      </div>
                      <div class="tp-acc-body" data-sec="relative" style="display:none;padding:12px 14px;">
                        <div style="display:flex;gap:24px;">
                          <div style="flex:1;">
                            <div style="font-weight:600;font-size:12px;margin-bottom:6px;">Earliest:</div>
                            <div style="display:flex;gap:6px;margin-bottom:8px;">
                              <input type="number" id="tp-rel-num" value="15" min="1" style="width:55px;padding:5px 7px;border:1px solid #ccc;border-radius:3px;font-size:13px;"/>
                              <select id="tp-rel-unit" style="padding:5px;border:1px solid #ccc;border-radius:3px;font-size:13px;">
                                <option value="m">Minutes Ago</option>
                                <option value="h">Hours Ago</option>
                                <option value="d">Days Ago</option>
                                <option value="w">Weeks Ago</option>
                                <option value="mon">Months Ago</option>
                              </select>
                            </div>
                            <label style="display:block;font-size:12px;margin-bottom:3px;cursor:pointer;"><input type="radio" name="tp-snap" value="none" checked="checked" style="margin-right:4px;"/>No snap-to</label>
                            <label style="display:block;font-size:12px;cursor:pointer;"><input type="radio" name="tp-snap" value="@m" style="margin-right:4px;"/>Beginning of minute</label>
                          </div>
                          <div style="flex:1;">
                            <div style="font-weight:600;font-size:12px;margin-bottom:6px;">Latest:</div>
                            <label style="display:block;font-size:12px;margin-bottom:3px;cursor:pointer;"><input type="radio" name="tp-lat" value="now" checked="checked" style="margin-right:4px;"/>Now</label>
                            <label style="display:block;font-size:12px;cursor:pointer;"><input type="radio" name="tp-lat" value="@m" style="margin-right:4px;"/>Beginning of current minute</label>
                          </div>
                        </div>
                        <div style="text-align:right;margin-top:10px;">
                          <button type="button" id="tp-rel-apply" class="btn btn-primary btn-sm">Apply</button>
                        </div>
                      </div>
                      <!-- Accordion: Real-time -->
                      <div class="tp-acc-head" data-sec="realtime" style="padding:9px 14px;font-size:13px;color:#5ba1cf;cursor:pointer;border-bottom:1px solid #eee;font-weight:500;">
                        <span class="tp-arrow" style="display:inline-block;font-size:10px;margin-right:5px;">&#9656;</span>Real-time
                      </div>
                      <div class="tp-acc-body" data-sec="realtime" style="display:none;">
                        <a class="tp-opt" data-e="rt-30s" data-l="rt" href="#">30 second window</a>
                        <a class="tp-opt" data-e="rt-1m" data-l="rt" href="#">1 minute window</a>
                        <a class="tp-opt" data-e="rt-5m" data-l="rt" href="#">5 minute window</a>
                        <a class="tp-opt" data-e="rt-30m" data-l="rt" href="#">30 minute window</a>
                        <a class="tp-opt" data-e="rt-1h" data-l="rt" href="#">1 hour window</a>
                      </div>
                      <!-- Accordion: Date Range -->
                      <div class="tp-acc-head" data-sec="daterange" style="padding:9px 14px;font-size:13px;color:#5ba1cf;cursor:pointer;border-bottom:1px solid #eee;font-weight:500;">
                        <span class="tp-arrow" style="display:inline-block;font-size:10px;margin-right:5px;">&#9656;</span>Date Range
                      </div>
                      <div class="tp-acc-body" data-sec="daterange" style="display:none;padding:12px 14px;">
                        <div style="display:flex;gap:10px;margin-bottom:10px;">
                          <div style="flex:1;"><label style="font-size:12px;font-weight:600;">Between</label><input type="date" id="tp-date-from" style="width:100%;padding:5px;border:1px solid #ccc;border-radius:3px;font-size:13px;margin-top:3px;"/></div>
                          <div style="flex:1;"><label style="font-size:12px;font-weight:600;">And</label><input type="date" id="tp-date-to" style="width:100%;padding:5px;border:1px solid #ccc;border-radius:3px;font-size:13px;margin-top:3px;"/></div>
                        </div>
                        <div style="text-align:right;"><button type="button" id="tp-date-apply" class="btn btn-primary btn-sm">Apply</button></div>
                      </div>
                      <!-- Accordion: Advanced -->
                      <div class="tp-acc-head" data-sec="advanced" style="padding:9px 14px;font-size:13px;color:#5ba1cf;cursor:pointer;font-weight:500;">
                        <span class="tp-arrow" style="display:inline-block;font-size:10px;margin-right:5px;">&#9656;</span>Advanced
                      </div>
                      <div class="tp-acc-body" data-sec="advanced" style="display:none;padding:12px 14px;">
                        <div style="margin-bottom:8px;"><label style="font-size:12px;font-weight:600;">Earliest</label><input type="text" id="tp-adv-e" style="width:100%;padding:5px;border:1px solid #ccc;border-radius:3px;font-size:13px;margin-top:3px;" placeholder="-15m"/></div>
                        <div style="margin-bottom:10px;"><label style="font-size:12px;font-weight:600;">Latest</label><input type="text" id="tp-adv-l" style="width:100%;padding:5px;border:1px solid #ccc;border-radius:3px;font-size:13px;margin-top:3px;" placeholder="now"/></div>
                        <div style="text-align:right;"><button type="button" id="tp-adv-apply" class="btn btn-primary btn-sm">Apply</button></div>
                      </div>
                    </div>
                  </div>
                  <input type="hidden" id="fld_dur_e" value="-15m"/>
                  <input type="hidden" id="fld_dur_l" value="now"/>
                </div>
                <div style="flex:1;">
                  <label class="form-label">Frequency</label>
                  <select id="fld_frequency" class="form-input">
                    <option value="*/5 * * * *">Every 5 min</option>
                    <option value="*/15 * * * *" selected="selected">Every 15 min</option>
                    <option value="*/30 * * * *">Every 30 min</option>
                    <option value="0 * * * *">Hourly</option>
                    <option value="0 */4 * * *">Every 4 hours</option>
                    <option value="0 0 * * *">Daily (midnight)</option>
                    <option value="0 8 * * *">Daily (8 AM)</option>
                    <option value="0 0 * * 0">Weekly (Sunday)</option>
                    <option value="0 0 1 * *">Monthly (1st)</option>
                    <option value="custom">Custom (cron)...</option>
                  </select>
                  <input type="text" id="fld_custom_cron" class="form-input" style="margin-top:5px;display:none;" placeholder="*/10 * * * * (min hr day mon dow)"/>
                </div>
              </div>
              <div style="margin-bottom:12px;">
                <label class="form-label">Threshold</label>
                <input type="number" id="fld_threshold" value="0" min="0" class="form-input"/>
              </div>
              <div style="margin-bottom:12px;">
                <label class="form-label">Trigger</label>
                <div id="trigger-toggle" style="display:flex;border:1px solid #ccc;border-radius:4px;overflow:hidden;">
                  <button type="button" class="trigger-btn active" data-value="once" style="flex:1;padding:8px 12px;border:none;cursor:pointer;font-size:13px;background:#1976d2;color:white;text-align:center;">Once</button>
                  <button type="button" class="trigger-btn" data-value="for_each_result" style="flex:1;padding:8px 12px;border:none;border-left:1px solid #ccc;cursor:pointer;font-size:13px;background:#f5f5f5;color:#333;text-align:center;">For each result</button>
                </div>
                <input type="hidden" id="fld_trigger" value="once"/>
                <span style="color:#666;font-size:11px;margin-top:4px;display:block;">Once = trigger once when threshold is met. For each result = trigger for every row returned.</span>
              </div>
              <div style="background:#f5f5f5;padding:10px;border-radius:4px;">
                <label style="font-weight:bold;cursor:pointer;">
                  <input type="checkbox" id="fld_throttle" style="margin-right:8px;"/>
                  Throttle
                </label>
                <span style="color:#666;font-size:11px;margin-left:5px;">Suppress triggering of actions</span>
                <div id="throttle-options" style="display:none;margin-top:8px;">
                  <label style="display:flex;align-items:center;gap:8px;font-size:12px;">
                    <span>Suppress for</span>
                    <input type="number" id="fld_suppression" value="60" min="1" style="width:70px;padding:6px;border:1px solid #ccc;border-radius:4px;"/>
                    <select id="fld_suppression_unit" style="padding:6px;border:1px solid #ccc;border-radius:4px;">
                      <option value="s">second(s)</option>
                      <option value="m" selected="selected">minute(s)</option>
                      <option value="h">hour(s)</option>
                    </select>
                  </label>
                </div>
              </div>
            </div>
            
          </div>
          
          <!-- Buttons -->
          <div style="margin-top:20px;text-align:center;">
            <button class="btn btn-default btn-lg" id="btn-preview">Preview</button>
            <button class="btn btn-primary btn-lg" id="btn-submit" style="margin:0 10px;">Submit</button>
            <button class="btn btn-default btn-lg" id="btn-clear">Clear</button>
          </div>
          
          <div id="form-errors" class="form-error-box"></div>
          
        </div>
      </html>
    </panel>
  </row>
  
  <row id="preview_row">
    <panel>
      <title>Preview Results</title>
      <html>
        <div style="margin-bottom:10px;">
          <strong>Full Query:</strong>
          <pre id="preview-query" style="background:#f5f5f5;padding:10px;border-radius:4px;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word;max-height:200px;overflow-y:auto;">-</pre>
        </div>
        <div style="margin-bottom:10px;">
          <strong>Status:</strong> <span id="preview-status">Pending</span> |
          <strong>Time:</strong> <span id="preview-time">-</span> |
          <strong>Results:</strong> <span id="preview-count">-</span>
        </div>
        <div id="preview-results">Click Preview to run</div>
      </html>
    </panel>
  </row>
  
  <row id="summary_row">
    <panel>
      <title>Summary</title>
      <html>
        <table class="table" style="width:auto;">
          <tbody>
            <tr><td style="font-weight:bold;width:150px;">Alert Name:</td><td id="sum-name">-</td></tr>
            <tr><td style="font-weight:bold;">Application:</td><td id="sum-app">-</td></tr>
            <tr><td style="font-weight:bold;">Ticket:</td><td id="sum-ticket">-</td></tr>
            <tr><td style="font-weight:bold;">Email:</td><td id="sum-email">-</td></tr>
            <tr><td style="font-weight:bold;">Priority:</td><td id="sum-priority">-</td></tr>
            <tr><td style="font-weight:bold;">Duration:</td><td id="sum-duration">-</td></tr>
            <tr><td style="font-weight:bold;">Frequency:</td><td id="sum-frequency">-</td></tr>
            <tr><td style="font-weight:bold;">Threshold:</td><td id="sum-threshold">-</td></tr>
            <tr><td style="font-weight:bold;">Trigger:</td><td id="sum-trigger">Once</td></tr>
            <tr><td style="font-weight:bold;">Throttle:</td><td id="sum-suppression">-</td></tr>
            <tr><td style="font-weight:bold;">Query:</td><td id="sum-query" style="max-width:600px;word-wrap:break-word;font-family:monospace;font-size:11px;">-</td></tr>
          </tbody>
        </table>
        <button class="btn btn-warning" id="btn-ack" disabled="disabled">Acknowledge Configuration</button>
        <span id="ack-status" style="margin-left:10px;"></span>
      </html>
    </panel>
  </row>
  
</dashboard>
